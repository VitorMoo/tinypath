{% extends 'base.html' %}

{% block title %}Cadastro - UnaTrack{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow border-0">
                <div class="row g-0">

                    <!-- Side Info -->
                    <div class="col-md-5 bg-primary text-white p-4 d-flex flex-column justify-content-center rounded-start">
                        <div class="text-center">
                            <i class="bi bi-calendar-check text-primary" style="font-size: 3rem;"></i>
                            <h2 class="fw-bold mt-3">Bem-vindo ao UnaTrack!</h2>
                            <p class="text-white-50">Gerencie suas atividades acadêmicas de forma fácil e prática.</p>
                        </div>
                    </div>

                    <!-- Form Area -->
                    <div class="col-md-7 p-5">
                        <h4 class="fw-bold text-primary mb-4">Criar Conta</h4>

                        <form method="post" id="registerForm" novalidate>
                            {% csrf_token %}

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="first_name" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="last_name" class="form-label">Sobrenome</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                                </div>
                            </div>

                            <div class="mt-3">
                                <label for="email" class="form-label">E-mail</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>

                            <div class="mt-3">
                                <label for="username" class="form-label">Nome de usuário</label>
                                <input type="text" class="form-control" id="username" name="username" required pattern="[a-zA-Z0-9_]+" title="Apenas letras, números e underscore">
                                <small class="text-muted">Apenas letras, números e underscore</small>
                            </div>

                            <div class="row g-3 mt-1">
                                <div class="col-md-6">
                                    <label for="password1" class="form-label">Senha</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="password1" name="password1" required minlength="8">
                                        <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                                            <i class="bi bi-eye" id="eyeIcon1"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="password2" class="form-label">Confirmar Senha</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="password2" name="password2" required minlength="8">
                                        <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                                            <i class="bi bi-eye" id="eyeIcon2"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-2 mb-3">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    A senha deve ter pelo menos 8 caracteres
                                </small>
                            </div>

                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-person-check me-2"></i>Criar Conta
                                </button>
                            </div>

                            <div class="text-center">
                                <p class="mb-0">Já tem uma conta?
                                    <a href="{% url 'login' %}" class="text-primary text-decoration-none fw-bold">
                                        Faça login
                                    </a>
                                </p>
                            </div>
                        </form>
                    </div>

                </div> <!-- row -->
            </div> <!-- card -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const togglePassword = (inputId, iconId) => {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        input.type = input.type === 'password' ? 'text' : 'password';
        icon.className = input.type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
    };

    document.getElementById('togglePassword1').addEventListener('click', () => togglePassword('password1', 'eyeIcon1'));
    document.getElementById('togglePassword2').addEventListener('click', () => togglePassword('password2', 'eyeIcon2'));

    const password1 = document.getElementById('password1');
    const password2 = document.getElementById('password2');

    const validatePasswords = () => {
        if (password1.value && password2.value) {
            if (password1.value !== password2.value) {
                password2.setCustomValidity('As senhas não coincidem');
                password2.classList.add('is-invalid');
            } else {
                password2.setCustomValidity('');
                password2.classList.remove('is-invalid');
                password2.classList.add('is-valid');
            }
        }
    };

    password1.addEventListener('input', validatePasswords);
    password2.addEventListener('input', validatePasswords);

    document.getElementById('registerForm').addEventListener('submit', function (e) {
        if (password1.value !== password2.value) {
            e.preventDefault();
            password2.focus();
        }
    });
});
</script>
{% endblock %}
